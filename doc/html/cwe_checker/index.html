<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>index (cwe_checker.index)</title><link rel="stylesheet" href="../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ cwe_checker</nav><h1 id="cwe_checker"><a href="#cwe_checker" class="anchor"></a>cwe_checker</h1><nav class="toc"><ul><li><a href="#contents">Contents</a></li><li><a href="#Basics">Basic usage</a><ul><li><a href="#how-to-use-the-docker-image">How to use the docker image</a></li></ul></li><li><a href="#CmdLineOptions">Command line options</a></li><li><a href="#ToolIntegration">Integration with IDA Pro</a></li><li><a href="#HackingHowto">How to write your own check</a><ul><li><a href="#step-1:-get-acquainted-with-bap">Step 1: Get acquainted with BAP</a></li><li><a href="#step-2:-write-the-check">Step 2: Write the check</a></li><li><a href="#step-3:-add-your-check-to-the-cwe_checker-plugin">Step 3: Add your check to the <i>cwe_checker</i> plugin</a></li></ul></li></ul></nav></header><h2 id="contents"><a href="#contents" class="anchor"></a>Contents</h2><ul><li><a href="index.html#Basics"><span>Basic usage</span></a></li><li><a href="index.html#CmdLineOptions"><span>Command line options</span></a></li><li><a href="index.html#ToolIntegration"><span>Integration with IDA Pro</span></a></li><li><a href="index.html#HackingHowto"><span>How to write your own check</span></a></li></ul><h2 id="Basics"><a href="#Basics" class="anchor"></a>Basic usage</h2><p><i>cwe_checker</i> is implemented as a plugin for the <a href="https://github.com/BinaryAnalysisPlatform/bap">Binary Analysis Platform</a> (BAP). To use it, just run BAP with <i>cwe_checker</i> as a pass:</p><pre><code class="ml">bap [BINARY_FILE] --pass=cwe_checker</code></pre><p>This runs all static analysis based checks. You can find more documentation on these checks at their <a href="../cwe_checker_core/Cwe_checker_core/index.html">module documentation pages</a>. The behaviour of these checks can be modified through an optional configuration file. Just edit the <code>src/config.json</code> file and then add <code>--cwe-checker-config=src/config.json</code> as a command line option. You can find more on the available command line options <a href="index.html#CmdLineOptions"><span>here</span></a>.</p><p>The symbolic execution based checks can be run with the emulation recipe in the recipes folder.</p><pre><code class="ml">bap PATH_TO_BINARY --recipe=recipes/emulation</code></pre><p>Note that these checks are rather slow at the moment and should only be applied to small binaries.</p><h3 id="how-to-use-the-docker-image"><a href="#how-to-use-the-docker-image" class="anchor"></a>How to use the docker image</h3><p>The docker image, which is based on the current master branch of the repository, can be installed with</p><pre><code class="ml">docker pull fkiecad/cwe_checker</code></pre><p>To use it, mount the target binary inside the docker container and call <i>bap</i> with <i>cwe_checker</i> as a pass as usual:</p><pre><code class="ml">docker run --rm -v [BINARY]:/tmp/input fkiecad/cwe_checker bap /tmp/input --pass=cwe-checker</code></pre><p>If you are using a customized <code>config.json</code> file, don't forget to mount it inside your container as well! If you want to print the output to a file with <code>--cwe-checker-out</code>, you also need to mount the output file to the docker container, or else the file will be lost once the container gets destroyed.</p><h2 id="CmdLineOptions"><a href="#CmdLineOptions" class="anchor"></a>Command line options</h2><p>All command line options have to be prefixed with <code>--cwe-checker</code> (so that BAP knows to forward them to the <i>cwe_checker</i> plugin). The available command line options are:</p><ul><li><code>-config=[FILE]</code> Use <code>[FILE]</code> as the configuration file. If you omit this option, <i>cwe_checker</i> uses a standard configuration file located at <code>src/config.json</code>.</li><li><code>-module-versions</code> Prints the version numbers of each check.</li><li><code>-json</code> Format the CWE-warnings as JSON. If you print to <i>stdout</i>, note that debug, info and error messages are not formatted as JSON and may pollute the output. Use <code>-no-logging</code> to suppress these messages.</li><li><code>-no-logging</code> Suppress printing of debug, info and error messages. This is useful if you want to print to <i>stdout</i> with the <code>-json</code> flag to prevent these messages polluting the JSON output.</li><li><code>-out=[FILE]</code> Print the CWE-warnings to the file located at <code>[FILE]</code>. Note that debug, info and error messages are still printed to stdout and not to the file.</li><li><code>-partial=[MODULE_LIST]</code> Only run the checks given in <code>[MODULE_LIST]</code>, where <code>[MODULE_LIST]</code> is a comma separated list of module names. E.g. <code>-partial=CWE190,CWE476</code> would only run the checks for CWE-190 and CWE-476. The names of all available modules can be printed with the <code>-module-versions</code> command line option.</li></ul><h2 id="ToolIntegration"><a href="#ToolIntegration" class="anchor"></a>Integration with IDA Pro</h2><p>To annotate CWE-hits in IDA Pro, first run <i>cwe_checker</i> and save the JSON-formatted output to a file.</p><pre><code class="ml">bap [BINARY] --pass=cwe-checker --cwe-checker-json --cwe-checker-out=cwe_hits.json</code></pre><p>Then run the <code>cwe_checker_to_ida.py</code> script located in the <code>cwe_checker_to_ida</code> folder.</p><pre><code class="ml">python3 cwe_checker_to_ida.py -i cwe_hits.json -o cwe_hits.py</code></pre><p>Now open the binary file in IDA Pro and execute the generated <code>cwe_hits.py</code> script from within IDA Pro (Alt+F7).</p><h2 id="HackingHowto"><a href="#HackingHowto" class="anchor"></a>How to write your own check</h2><h3 id="step-1:-get-acquainted-with-bap"><a href="#step-1:-get-acquainted-with-bap" class="anchor"></a>Step 1: Get acquainted with BAP</h3><p><i>cwe_checker</i> interfaces via OCaml with the <a href="https://github.com/BinaryAnalysisPlatform/bap">Binary Analysis Platform</a> as a backend and you should read its documentation. All information about a binary file is gathered through BAP.</p><h3 id="step-2:-write-the-check"><a href="#step-2:-write-the-check" class="anchor"></a>Step 2: Write the check</h3><p>You need a <code>your_check.ml</code> and a <code>your_check.mli</code> file that should be located in the <code>src/checkers</code> folder. The <code>your_check.mli</code> file should look like this:</p><pre><code class="ml">(** This module implements your_check.

    Some more documentation about your_check.
*)

val name : string     (* The name of your check *)
val version : string  (* The version of your check (e.g. &quot;0.1&quot;). *)

val check_cwe : Bap.Std.program Bap.Std.term -&gt; Bap.Std.project -&gt; Bap.Std.word Bap.Std.Tid.Map.t -&gt; string list list -&gt; string list -&gt; unit</code></pre><p>A corresponding example <code>your_check.ml</code> file, which just prints a &quot;hello world&quot; message, would look like this:</p><pre><code class="ml">open Core_kernel
open Bap.Std    (* To interface with BAP *)

let name = &quot;your_check&quot;
let version = &quot;0.1&quot;

let check_cwe program project tid_map symbol_pairs parameters =
  Log_utils.info &quot;Hello world!&quot;</code></pre><p>In practice you would use the parameters of <i>check_cwe</i>-function to gather the necessary information for the computation of your check. These parameters are:</p><ul><li><code>program: Bap.Std.program Bap.Std.term</code> The program term of the binary</li><li><code>project: Bap.Std.project</code> The BAP-project term of the binary</li><li><code>Tid_map: Bap.Std.word Bap.Std.Tid.Map.t</code> A map from the Tids of basic blocks to concrete addresses in the binary file</li><li><code>symbols_pairs: string list list</code> Symbols read from the <i>config.json</i> file</li><li><code>parameters: string list</code> Parameters read from the config.json file</li></ul><p>The results of your check should be reported back to the user via the functions in the <a href="../cwe_checker_core/Cwe_checker_core/Log_utils/index.html">Log_utils</a>-module. See its module-level documentation for more details.</p><h3 id="step-3:-add-your-check-to-the-cwe_checker-plugin"><a href="#step-3:-add-your-check-to-the-cwe_checker-plugin" class="anchor"></a>Step 3: Add your check to the <i>cwe_checker</i> plugin</h3><p>The main file of the <i>cwe_checker</i> plugin is located at <code>plugins/cwe_checker/cwe_checker.ml</code>. In there you have to add your check to the list of <i>known_modules</i>. Here the <i>requires_pairs</i> flag controls whether the symbols in the <code>config.json</code> file are a string list or a list of string lists. The <i>has_parameters</i> flag controls whether the <code>config.json</code> file contains parameters to control the behaviour of the check.</p><p>Now just recompile <i>cwe_checker</i> via <code>make all</code> and your check will be available for use.</p></div></body></html>